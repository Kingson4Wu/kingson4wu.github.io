---
title: 长连接服务需注意什么？
date: 2022-05-06 15:43:39
tags: [长连接]
---

## 边缘服务
+ 边缘服务的网络质量很重要，覆盖不好会有弱网问题

## 网络相关命令
+ dig命令 ：
    - 一个域名可以有两种类型的指向，如果一个 域名指向 称为一个 记录 （Record）的话，那么就有两种 记录类型 （Record Type），分别是：
      A记录 ：指向一个IP地址 （地址记录）
      CNAME ：指向一个其他的域名（别名记录）
      NS : 名字服务器记录(理解为dns服务器 )
+ linux查看网络路由跳转
`traceroute   www.baidu.com`

+ 查看路由表
`route -n（netstat -rn）`  

+ nslookup  

## 使用tcp长连通信 （个人总结）
+ 一般都是直接用ip端口的方式；一般情况下域名都是公共的，很少会为了某些业务暴露端口，所以一般直接ip端口直接连应用（边缘服务器？？）  
+ 使用ip端口相连会有部分用户连不上的问题，比如只有北京的外网ip，用户在广州，可能会连接不稳定（没走专线）
+ 非tcp长连，普通的http请求走域名（或cdn），返回用户一个就近的ip，进入这个ip之后，之后的通信都是内网通信（运营商内网，专线，CDN专线等）
+ 所以一般使用tcp长连，需要很多个边缘节点ip，分布在各个地方的机房，并配合合适的调度策略（根据机器的负载情况）（腾讯im有大量的边缘服务？）
+ 如果没足够的边缘机器（部署几个重要的边缘服务，其他的降级走http（域名），不走长连？？）


### 边缘计算机器
+ 边缘计算机器（Edge Computing Machine，ECM）通过将计算能力从中心节点下沉到靠近用户的边缘节点，为您提供低时延、高可用、低成本的边缘计算服务。
+ CDN俗称“边缘节点服务”。可用于网站加速、将源站内容分发至最接近用户的节点，使用户可就近取得所需内容，提高用户访问的响应速度和成功率。解决因分布、带宽、服务器性能带来的访问延迟问题，适用于站点加速、点播、直播等场景。
+ 还有边缘节点服务（Edge Node Service, ENS）提供基于CDN的边缘弹性基础设施，使您可以将计算、转发等业务下沉至边缘。降低响应时延和带宽成本、减轻中心集群压力，适用于“中心+边缘”架构模型下的各类业务。

## 使用websocket     

## BGP AnyCast
+ BGP AnyCast 的部署成本比较大，基本由一定规模的公司才会实施这一套方案（比如阿里云、腾讯云等），并以云服务的形式提供给其他企业使用。
+ 以腾讯云为例
	- Anycast 公网加速（Anycast Internet Acceleration，AIA）是一个覆盖多地的动态加速网络，可以大幅提升您业务的公网访问体验。AIA 不同于其他应用层加速服务，它能实现 IP 传输的质量优化和多入口就近接入，减少网络传输的抖动、丢包，最终提升云上应用的服务质量，扩大服务范围，精简后端部署。
	- 疑惑：在AnyCast网络中多个主机用同一个IP，这岂不是IP地址冲突了？
	  1. 首先，每一个节点主机处在不同的地理位置，相互之间不在同一个广播域内。所以把所有主机配置成相同的IP地址并不会引起我们日常所见的IP地址冲突；
	  2. 其次，在仅仅配置相同IP之外，还需要借助BGP协议进行地址宣告，通过BGP，各个站点向Internet宣告相同的AnyCast IP地址。

## Reference
+ [002.AnyCast技术浅析](https://cloud.tencent.com/developer/article/1473063)